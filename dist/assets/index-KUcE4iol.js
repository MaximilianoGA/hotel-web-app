import{UltravoxSession as w}from"https://esm.sh/ultravox-client@0.3.6";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function a(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(e){if(e.ep)return;e.ep=!0;const o=a(e);fetch(e.href,o)}})();/**
 * @license
 * SPDX-License-Identifier: Apache-2.0
*/const y=document.getElementById("callStatus"),m=document.getElementById("bookingDetails"),f=document.getElementById("bookingTotal"),b=document.getElementById("startCall"),h=document.getElementById("endCall"),E=document.getElementById("chat-bubble-button"),l=document.getElementById("chat-panel-container"),v=document.getElementById("close-chat-panel"),u=document.getElementById("systemPrompt"),B="oRfuQ0YG.JX8cMYNQiHdXGsmP8dVFHGLOtUbSREEL",I="50696f55-794c-443f-b4a1-8be8bde94e8d",i=new w;function x(){l==null||l.classList.add("is-open")}function p(){l==null||l.classList.remove("is-open")}let r=null;function g(){if(!m||!f)return;if(!r){m.innerHTML='<p class="text-gray-500">Aún no ha seleccionado una habitación.</p>',f.textContent="$0.00";return}m.innerHTML=`
        <div class="flex justify-between items-start">
            <div>
                <p class="font-semibold text-blue-800">${r.name}</p>
                <p class="text-sm text-gray-600">${r.nights} noche(s)</p>
            </div>
            <p class="font-semibold text-lg">$${(r.price*r.nights).toFixed(2)}</p>
        </div>
    `;const n=r.price*r.nights;f.textContent=`$${n.toFixed(2)}`}window.addEventListener("updateBooking",n=>{const{roomId:t,roomName:a,price:s}=n.detail;r={id:t,name:a,price:s,nights:1},g()});function c(n,t="info"){if(!y)return;const a={info:"text-blue-600",success:"text-green-600",warning:"text-yellow-600",error:"text-red-600",neutral:"text-gray-600"};y.innerHTML=`<span class="${a[t]}">${n}</span>`}async function C(n,t,a){try{c("Iniciando asistente...","info");const e=await fetch("https://api.ultravox.ai/api/calls",{method:"POST",headers:{"Content-Type":"application/json","X-Unsafe-API-Key":n},body:JSON.stringify({systemPrompt:t,voice:a,temperature:.4})});if(!e.ok){const d=await e.text();throw new Error(`HTTP ${e.status}: ${d}`)}return(await e.json()).joinUrl}catch(s){throw console.error("Error creando la llamada directa:",s),c(`Error: ${s.message}`,"error"),s}}i.registerToolImplementation("updateBookingDetails",n=>{console.log("Herramienta del cliente `updateBookingDetails` llamada con:",n);const{roomId:t,roomName:a,price:s}=n;if(t&&a&&typeof s=="number"){const e=new CustomEvent("updateBooking",{detail:{roomId:t,roomName:a,price:s}});window.dispatchEvent(e);const o=`Se seleccionó '${a}'.`;return JSON.stringify({success:!0,message:o})}else{const e="Parámetros inválidos recibidos para updateBookingDetails.";return console.error(e,n),JSON.stringify({success:!1,message:e})}});i.addEventListener("status",()=>{const t={connecting:{message:"Conectando...",type:"info"},connected:{message:"Conectado. ¡Hola!",type:"success"},disconnecting:{message:"Desconectando...",type:"warning"},disconnected:{message:"Desconectado",type:"neutral"}}[i.status]||{message:`Estado: ${i.status}`,type:"info"};c(t.message,t.type),i.status==="disconnected"&&(r=null,g(),console.log("La reserva se ha borrado al finalizar la llamada."),p())});E&&(E.onclick=()=>x());v&&(v.onclick=()=>p());b&&(b.onclick=async function(){try{if(!(u!=null&&u.value)){c("El System Prompt no puede estar vacío.","error");return}const n=u.value,t=await C(B,n,I);if(!t)return;c("Conectando a la llamada...","info"),await i.joinCall(t)}catch(n){c(`Fallo al iniciar: ${n.message}`,"error")}});h&&(h.onclick=async function(){c("Finalizando...","warning"),await i.leaveCall(),p()});g();
